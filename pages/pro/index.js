function requestTokenFromBackground(e){chrome.runtime.sendMessage({message:"generate_token"},(t=>{"token_generated"===t.message&&e(t.payload)}))}const modal=document.getElementById("price-modal"),modalContent=document.getElementById("price-modal-content"),modalSpinner=document.getElementById("price-modal-loading-overlay");function openPriceModal(){modal.style.display="block",document.getElementsByTagName("body").item(0).classList.add("price-modal__open")}function closePriceModal(){const e=new URLSearchParams(window.location.search);e.delete("prices"),window.history.replaceState("",null,window.location.pathname+"?"+e),modal.style.display="none",modalContent.style.display="flex",modalSpinner.style.display="none",document.getElementsByTagName("body").item(0).classList.remove("price-modal__open")}function checkoutSubscriptionFromBackground(e){modalContent.style.display="none",modalSpinner.style.display="flex",chrome.runtime.sendMessage({event:"checkout_subscription",price:e},(e=>{e||alert("Something went wrong"),closePriceModal()}))}window.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelectorAll(".price-modal__price"),t=document.querySelector(".price-modal__checkout-button");e.forEach((t=>{t.addEventListener("click",(()=>{e.forEach((e=>e.setAttribute("data-selected","false"))),t.setAttribute("data-selected","true")}))})),t&&t.addEventListener("click",(()=>{const e=document.querySelector('.price-modal__price[data-selected="true"]');if(!e)return;const t="yearly"===e.getAttribute("data-plan")?"pro_yearly":"pro_monthly";chrome.runtime.sendMessage({event:"checkout_subscription",price:t},(e=>{e||console.error("Checkout failed")}))}))}));const oldPrices=document.getElementsByClassName("price-modal__price");for(const e of oldPrices)e.onclick=null;const buyLicenseBtn=document.getElementById("buy-license"),upgradeBtn=document.getElementById("upgrade"),closePriceModalBtn=document.getElementById("close-price-modal");function getSsoAuthorizationFromBackground(e){e.preventDefault(),chrome.runtime.sendMessage({event:"auth_authorize"},(e=>{e||alert("Something went wrong")}))}function getUserInfoFromBackground(e){chrome.runtime.sendMessage({event:"get_user_info"},(t=>{t?e&&e():alert("Something went wrong")}))}function putLicenseKeyFromBackground(){chrome.runtime.sendMessage({event:"put_license_key"},(e=>{e||alert("Something went wrong")}))}buyLicenseBtn&&(buyLicenseBtn.onclick=openPriceModal),upgradeBtn&&(upgradeBtn.onclick=openPriceModal),closePriceModalBtn&&(closePriceModalBtn.onclick=closePriceModal),document.onclick=function(e){e.target==modal&&closePriceModal()},document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("license_key_input"),t=document.getElementById("save_license_key"),n=document.getElementById("license_key_status"),o=document.getElementById("no_license"),s=document.getElementById("upgrade"),c=()=>{e.disabled=!0,t.disabled=!0,o.hidden=!0,s.hidden=!0};e&&t&&n&&(chrome.storage.sync.get(["deviceId","license_key","isPro"],(t=>{t.isPro?(e.value=t.license_key,c()):(e.placeholder="8D248C59-3DCD4033-B41E8890-845FDBAD",o.hidden=!1,s.hidden=!1)})),t.addEventListener("click",(()=>{const o=e.value;t.disabled=!0,requestTokenFromBackground((e=>{fetch("http://coral-app-opv8j.ondigitalocean.app/verify_license",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({license_key:o})}).then((e=>e.json())).then((e=>{e.success?(chrome.storage.sync.set({deviceId:e.deviceId,license_key:o,isPro:!0}).then((()=>{chrome.storage.sync.get("uid",(function(e){e.uid&&putLicenseKeyFromBackground()}))})),n.textContent="License key valid!",c()):(n.textContent="Invalid license key!",t.disabled=!1)})).catch((e=>{console.error("Error verifying license key:",e),n.textContent="Invalid license key!",t.disabled=!1}))}))})));const a=document.getElementById("input_license_key"),i=document.getElementById("about_link"),l=document.getElementById("settings_link"),d=document.querySelector(".license-section"),r=document.getElementById("about"),m=document.querySelector(".setting-item"),u=document.getElementById("stealth_shortcut"),y=document.getElementById("save_settings"),g=document.getElementById("settings_status"),p=new URLSearchParams(window.location.search);"show"===p.get("prices")&&openPriceModal();const h=p.get("tab");"settings"===h?(d.classList.remove("active"),r.classList.remove("active"),m.classList.add("active")):"license_key"===h?(r.classList.remove("active"),m.classList.remove("active"),d.classList.add("active")):(d.classList.remove("active"),m.classList.remove("active"),r.classList.add("active")),a&&i&&l&&d&&r&&m&&(a.addEventListener("click",(e=>{e.preventDefault(),d.style.display="block",r.style.display="none",m.style.display="none"})),i.addEventListener("click",(e=>{e.preventDefault(),d.style.display="none",m.style.display="none",r.style.display="block"})),l.addEventListener("click",(e=>{e.preventDefault(),d.style.display="none",r.style.display="none",m.style.display="block"}))),u&&(chrome.storage.sync.get(["stealthShortcut"],(e=>{e.stealthShortcut?u.value=e.stealthShortcut:navigator.platform.toLowerCase().includes("win")?(u.value="Ctrl+Shift+Q",chrome.storage.sync.set({stealthShortcut:"Ctrl+Shift+Q"})):navigator.platform.toLowerCase().includes("mac")&&(u.value="Command+Shift+Q",chrome.storage.sync.set({stealthShortcut:"Command+Shift+Q"}))})),u.addEventListener("keydown",(function(e){e.preventDefault(),e.stopPropagation();const t=[];e.ctrlKey&&t.push("Ctrl"),e.shiftKey&&t.push("Shift"),e.altKey&&t.push("Alt"),e.metaKey&&t.push("Command");const n=e.key.toUpperCase();if(!["CONTROL","SHIFT","ALT","META","COMMAND"].includes(n)){const e=`${t.join("+")}+${n}`;this.value=e}})),y&&y.addEventListener("click",(()=>{const e=u.value;e?chrome.storage.sync.set({stealthShortcut:e},(()=>{g.textContent="Settings saved!",chrome.runtime.sendMessage({message:"updateStealthShortcut",shortcut:e})})):g.textContent="Please set a shortcut first"})));const v=document.getElementById("sign-in-button"),k=document.getElementById("get-started-button"),B=document.getElementById("greeting"),f=document.getElementById("user-name");v.addEventListener("click",getSsoAuthorizationFromBackground),k.addEventListener("click",getSsoAuthorizationFromBackground),getUserInfoFromBackground((function(){chrome.storage.sync.get("name",(function(e){e.name?(f.textContent=e.name.split(" ")[0],B.hidden=!1):(v.hidden=!1,k.hidden=!1)}))}));document.querySelectorAll(".price-modal__price").forEach((e=>{e.addEventListener("mousemove",(t=>{const n=e.getBoundingClientRect();e.style.setProperty("--mouse-x",t.clientX-n.left+"px"),e.style.setProperty("--mouse-y",t.clientY-n.top+"px")}))}))}));